name: Deploy New Estate Nuanu - Kirby CMS

on:
  push:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: executing remote ssh commands using password
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.DEV_HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.DEV_SSH_KEY }}
        script: |
            sudo -i
            whoami
            sleep 5
            cd /var/www/html/new-nuanu
            git config --global --add safe.directory /var/www/html/new-nuanu
            sleep 5
            if [[ $(git status --porcelain | wc -l) -gt 0 ]]; then   
                echo "New Update Found - Processing git command push and pull" 
                git add .
                sleep 5
                git commit -m [UPDATE]From server
                sleep 5
                git pull origin main
                sleep 10
            else 
                echo "No Update Found"
                git pull origin main
                sleep 10
            fi
            sudo systemctl restart nginx
            
